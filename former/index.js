// ======================== LISTE COURTE =====================================================================================

const short_entries = [
  //Collectibles
  "Sauver 5 grubs",
  "Sauver 7 grubs",
  "Compléter 10 entrées du journal du chasseur",
  "Collecter 3 cartes",
  "Ouvrir 3 stations",
  //Boss
  "Vaincre Hornet 1",
  "Vaincre Hornet 1",
  "Vaincre le Faux Chevalier",
  "Vaincre le Faux Chevalier",
  "Vaincre la mère Gruz",
  "Vaincre la Mouche Vengeresse Royale",
  "Vaincre les Dames Mantes",
  "Vaincre le Mawlek Pessimiste",
  //Charmes
  "Obtenir la Boussole Murmurante",
  "Obtenir l'Essaim Cueilleur",
  "Obtenir la Carapace Infrangible",
  "Obtenir Capturâme",
  "Obtenir le Maître de la Vitesse",
  "Obtenir le Maître de la célérité",
  "Obtenir le Chant des Larves",
  "Obtenir la Fureur des Disparus",
  "Obtenir les Epines d'Agonie",
  //Items
  "Compléter un Masque",
  "Obtenir la Cape Ailes de Papillon",
  "Obtenir l'Esprit Vengeur",
  "Obtenir un Journal du Voyageur",
  //Events
  "Sauver Zote 1",
  "Parler à Myla",
  "Rencontrer Cloth 1 fois",
  "Parler à Quirrel 2 fois",
];

// ======================== LISTE MOYENNE =====================================================================================

const mid_entries = [
  //Collectibles
  "Sauver 7 grubs",
  "Sauver 12 grubs",
  "Compléter 25 entrées du Journal",
  "compléter 2 racines",
  "Récupérer 5 cartes",
  "Ouvrir 5 stations",
  //Boss
  "Vaincre le Défenseur Bousier",
  "Vaincre Flukemarm",
  "Vaincre le Gardien de Cristal",
  "Vaincre le Maître de l'âme",
  //Boss des rêves
  "Vaincre Hu l'ancien",
  "Vaincre Xero",
  "Vaincre Gorb",
  "Vaincre Galien",
  "Vaincre Marmu",
  //Charmes
  "Obtenir la Pierre du Shaman",
  "Obtenir le Coeur Fragile",
  "Obtenir la Cupidité Fragile",
  "Obtenir la Force Fragile",
  "Obtenir le Tourmenteur d'Âme",
  "Obtenir Roc Solide",
  "Obtenir Coup Puissant",
  "Obtenir Longue Lame",
  "Obtenir la Marque de Respect",
  "Obtenir la Carapace de Baldur",
  "Obtenir le Nid de Flukes",
  "Obtenir l'Ecu du Defenseur",
  "Obtenir la Canalisation Rapide",
  "Obtenir le Coeur Sang de Vie",
  "Obtenir Champi Spore",
  "Obtenir le Chant du Tisserand",
  "Obtenir le Bouclier Ethéré",
  "Obtenir l'Héritier de Grimm",
  //Items
  "Compléter 2 Masques",
  "Compléter un Receptacle",
  "Obtenir Elan Ravageur",
  "Obtenir un Sceau d'Hallownest",
  "Obtenir l'Aiguillon des Rêves",
  "Obtenir les Pinces de Mantes",
  "Obtenir le Coeur de Cristal",
  //Events
  "Réveiller un réveur",
  "Finir l'Epreuve des Guerriers",
  "Dévérouiller un Ascenceur",
  "Améliorer l'Aiguillon 1 fois",
  "Invoquer la Troupe de Grimm",
  "Parler à Quirrel 4 fois",
];

// ======================== LISTE LONGUE =====================================================================================

const long_entries = [
  //Collectibles
  "Sauver 12 grubs",
  "Sauver 17 grubs",
  "Compléter 50 entrées du Journal",
  "Compléter 4 racines",
  "Récupérer 8 cartes",
  "Ouvrir 8 stations",
  //Boss
  "Vaincre le Chevalier de la Ruche",
  "Vaincre Grimm",
  "Vaincre Hornet 2",
  "Vaincre le Collectionneur",
  "Vaincre Nosk",
  "Vaincre Uumuu",
  "Vaincre le Vaisseau Corrompu",
  "Vaincre les Chevaliers Veilleurs",
  "Vaincre le Gardien Enragé",
  //Boss des Rêves
  "Vaincre Sans Yeux",
  "Vaincre le Proche Disparu",
  "Vaincre le Protecteur Blanc",
  "Vaincre Zote le Prince Gris",
  "Vaincre le Tyran de l'Âme",
  //Charmes
  "Obtenir le Mangeur d'Âme",
  "Obtenir l'Entaille Rapide",
  "Obtenir le Ventre Rutilant",
  "Obtenir la Canalisation Intense",
  "Obtenir le Noyau Sang de Vie",
  "Obtenir la Bénédiction de Joni",
  "Obtenir le Sang de Riche",
  "Obtenir l'Ombre Tranchante",
  "Obtenir la Forme d'Unn",
  "Obtenir la Gloir du Maître d'Aiguillon",
  "Obtenir le Porteur des Rêves",
  "Obtenir la Mélodie Insouciante",
  //Items
  "Compléter 3 Masques",
  "Apprendre les Spectres Hurleurs",
  "Apprendre les Ténèbres Descendantes",
  "Apprendre l'Âme d'Ombre",
  "Obtenir la Larme d'Isma",
  "Obtenir les Ailes de Monarque",
  "Obtenir la Cape des Ombres",
  "Obtenir le Portail des Rêves",
  "Apprendre l'Entaille Eclair",
  "Apprendre l'Entaille Implacable",
  "Apprendre l'Entaile Cyclone",
  "Récupérer une Idole du Roi",
  "Récupérer le Pass de Tram Way",
  //Events
  "Réveiller 2 Réveurs",
  "Finir l'Epreuve des Conquérants",
  "Sauver Zote dans le Nid Profond",
  "Améliorer l'Aguillon 2 fois",
  "Parler à Quirrel 6 fois",
  "Sauver Cloth des Mawlek",
];

// ======================== LISTE INTERMINABLE =====================================================================================

const inf_entries = [];

// ======================== LISTE RANDOM =====================================================================================

const rnd_entries = [
  //Collectibles
  "Sauver 7 grubs",
  "Sauver 12 grubs",
  "Compléter 25 entrées du Journal",
  "compléter 2 racines",
  "Récupérer 5 cartes",
  "Ouvrir 5 stations",
  "Compléter 2 Masque",
  "Compléter 1 Recpetacle",
  //Boss
  "Vaincre Hornet 1",
  "Vaincre le Faux Chevalier",
  "Vaincre la mère Gruz",
  "Vaincre la Mouche Vengeresse Royale",
  "Vaincre les Dames Mantes",
  "Vaincre le Mawlek Pessimiste",
  "Vaincre le Chevalier de la Ruche",
  "Vaincre Grimm",
  "Vaincre Hornet 2",
  "Vaincre Nosk",
  "Vaincre Uumuu",
  "Vaincre le Vaisseau Corrompu",
  "Vaincre les Chevaliers Veilleurs",
  "Vaincre le Défenseur Bousier",
  "Vaincre Flukemarm",
  "Vaincre le Gardien de Cristal",
  "Vaincre le Maître de l'âme",
  //Boss des Rêves
  "Vaincre Hu l'ancien",
  "Vaincre Xero",
  "Vaincre Gorb",
  "Vaincre Galien",
  "Vaincre Marmu",
  "Vaincre Sans Yeux",
  "Vaincre le Proche Disparu",
  "Vaincre le Protecteur Blanc",
  "Vaincre Zote le Prince Gris",
  "Vaincre le Tyran de l'Âme",
  //Charmes
  "Obtenir la Boussole Murmurante",
  "Obtenir l'Essaim Cueilleur",
  "Obtenir la Carapace Infrangible",
  "Obtenir Capturâme",
  "Obtenir le Maître de la Vitesse",
  "Obtenir le Maître de la célérité",
  "Obtenir le Chant des Larves",
  "Obtenir la Fureur des Disparus",
  "Obtenir les Epines d'Agonie",
  "Obtenir la Pierre du Shaman",
  "Obtenir le Coeur Fragile",
  "Obtenir la Cupidité Fragile",
  "Obtenir la Force Fragile",
  "Obtenir le Tourmenteur d'Âme",
  "Obtenir Roc Solide",
  "Obtenir Coup Puissant",
  "Obtenir Longue Lame",
  "Obtenir la Marque de Respect",
  "Obtenir la Carapace de Baldur",
  "Obtenir le Nid de Flukes",
  "Obtenir l'Ecu du Defenseur",
  "Obtenir la Canalisation Rapide",
  "Obtenir le Coeur Sang de Vie",
  "Obtenir Champi Spore",
  "Obtenir le Chant du Tisserand",
  "Obtenir le Bouclier Ethéré",
  "Obtenir l'Héritier de Grimm",
  "Obtenir le Mangeur d'Âme",
  "Obtenir l'Entaille Rapide",
  "Obtenir le Ventre Rutilant",
  "Obtenir la Canalisation Intense",
  "Obtenir le Noyau Sang de Vie",
  "Obtenir la Bénédiction de Joni",
  "Obtenir le Sang de Riche",
  "Obtenir l'Ombre Tranchante",
  "Obtenir la Forme d'Unn",
  "Obtenir la Gloir du Maître d'Aiguillon",
  "Obtenir le Porteur des Rêves",
  "Obtenir la Mélodie Insouciante",
  "Obtenir le Larve Mocuhe élégie",
  "Obtenir l'Âme royale / le Coeur du Vide",
  //ITEMS
  "Obtenir la Cape Ailes de Papillon",
  "Obtenir l'Esprit Vengeur",
  "Obtenir un Journal du Voyageur",
  "Obtenir Elan Ravageur",
  "Obtenir un Sceau d'Hallownest",
  "Obtenir l'Aiguillon des Rêves",
  "Obtenir les Pinces de Mantes",
  "Obtenir le Coeur de Cristal",
  "Apprendre les Spectres Hurleurs",
  "Apprendre les Ténèbres Descendantes",
  "Apprendre l'Âme d'Ombre",
  "Obtenir la Larme d'Isma",
  "Obtenir les Ailes de Monarque",
  "Obtenir la Cape des Ombres",
  "Obtenir le Portail des Rêves",
  "Apprendre l'Entaille Eclair",
  "Apprendre l'Entaille Implacable",
  "Apprendre l'Entaile Cyclone",
  "Récupérer une Idole du Roi",
  "Récupérer le Pass de Tram Way",
  "Dévérouiller les Ascenceurs",
  "Améliorer l'Aguillon 2 fois",
  "Apprendre le Cri des Abysses",
  "Obtenir L'Aiguillon des Rêves Eveillé",
  "Récupérer un Oeuf Arcanique",
  //EVENTS
  "Sauver Zote 1",
  "Parler à Myla",
  "Rencontrer Cloth 1 fois",
  "Parler à Quirrel 2 fois",
  "Réveiller 2 Réveurs",
  "Invoquer la Troupe de Grimm",
];

// ======================== COPY LISTE ==================================================

function entries_copy(entries) {
  return JSON.parse(JSON.stringify(entries));
}

// FONCTIONS VICTOIRE

let grid_matrix = [
  [0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0],
];

function check_ligne(array) {
  let bonnes_lignes = [];
  for (let ligne = 0; ligne < array.length; ligne++) {
    buffer = 1;
    for (let elt = 0; elt < array[ligne].length; elt++) {
      buffer = buffer * array[ligne][elt];
    }
    array[ligne];
    if (buffer == 1) {
      bonnes_lignes.push(ligne);
    }
  }
  //console.log(bonnes_lignes)
  return bonnes_lignes;
}

function check_colonne(array) {
  let bonnes_colonnes = [];
  for (let colonne = 0; colonne < array.length; colonne++) {
    buffer = 1;
    for (let elt = 0; elt < array[colonne].length; elt++) {
      buffer = buffer * array[elt][colonne];
    }
    array[colonne];
    if (buffer == 1) {
      bonnes_colonnes.push(colonne);
    }
  }
  //console.log(bonnes_colonnes)
  return bonnes_colonnes;
}

function check_diag(array) {
  let bonnes_diag = [];
  let buffer_NW = 1;
  let buffer_NE = 1;
  for (let i = 0; i < array.length; i++) {
    buffer_NW = buffer_NW * array[i][i];
    buffer_NE = buffer_NE * array[array.length - 1 - i][i];
  }
  if (buffer_NW == 1) {
    bonnes_diag.push(0);
  }
  if (buffer_NE == 1) {
    bonnes_diag.push(1);
  }
  //console.log(bonnes_diag)
  return bonnes_diag;
}

function check_win(array) {
  for (let ligne = 1; ligne < 6; ligne++) {
    for (let colonne = 1; colonne < 6; colonne++) {
      const id = 10 * ligne + colonne;
      if (document.getElementById(id).classList.contains("win")) {
        document.getElementById(id).classList.remove("win");
        document.getElementById(id).classList.add("neutral");
      }
    }
  }
  if (check_colonne(array).length > 0) {
    console.log(check_colonne(array));
    check_colonne(array).forEach((colonne) => {
      for (let ligne = 1; ligne < array.length + 1; ligne++) {
        let i = ligne * 10 + colonne + 1;
        switch_win(i);
      }
    });
  }
  if (check_ligne(array).length > 0) {
    console.log(check_ligne(array));
    check_ligne(array).forEach((ligne) => {
      for (let colonne = 1; colonne < array.length + 1; colonne++) {
        let i = (ligne + 1) * 10 + colonne;
        switch_win(i);
      }
    });
  }
  if (check_diag(array).length > 0) {
    check_diag(array).forEach((coef) => {
      if (coef == 0) {
        for (let ligne = 1; ligne < array.length + 1; ligne++) {
          let i = ligne * 10 + ligne;
          switch_win(i);
        }
      }
      if (coef == 1) {
        for (let ligne = 1; ligne < array.length + 1; ligne++) {
          let i = (array.length + 1 - ligne) * 10 + ligne;
          switch_win(i);
        }
      }
    });
  }
}

function switch_win(id) {
  if (document.getElementById(id).classList.contains("neutral")) {
    document.getElementById(id).classList.remove("neutral");
    document.getElementById(id).classList.add("win");
  }
}

function case_update(id) {
  if (mode == "select") {
    select(id);
  } else if (mode == "lock") {
    lock(id);
  } else {
    goal(id);
  }
}

//SELECTIONNE UNE CASE EN CLIQUANT DESSUS

function select(id) {
  console.log("select", mode);
  if (mode == "select") {
    let selected = document.getElementById(id).classList.contains("select");
    let value = document.getElementById(id).innerText;
    if (selected) {
      document.getElementById(id).classList.remove("select");
      document.getElementById(id).classList.add("bingo_box");
      for (let ligne = 1; ligne < 6; ligne++) {
        for (let colonne = 1; colonne < 6; colonne++) {
          let id_parcours = ligne.toString() + colonne.toString();
          if (document.getElementById(id_parcours).innerText == value) {
            grid_matrix[ligne - 1][colonne - 1] = 0;
            document.getElementById(id_parcours).classList.remove("select");
            document.getElementById(id_parcours).classList.add("bingo_box");
          }
        }
      }
    } else if (!document.getElementById(id).classList.contains("locked")) {
      document.getElementById(id).classList.remove("bingo_box");
      document.getElementById(id).classList.add("select");
      console.log(document.getElementById(id).classList);
      for (let ligne = 1; ligne < 6; ligne++) {
        for (let colonne = 1; colonne < 6; colonne++) {
          let id_parcours = ligne.toString() + colonne.toString();
          if (document.getElementById(id_parcours).innerText == value) {
            grid_matrix[ligne - 1][colonne - 1] = 1;
            if (
              document.getElementById(id_parcours).classList.contains("goal")
            ) {
              document.getElementById(id_parcours).classList.remove("goal");
            } else {
              document
                .getElementById(id_parcours)
                .classList.remove("bingo_box");
            }
            document.getElementById(id_parcours).classList.add("select");
          }
        }
      }
    }
    check_win(grid_matrix);
  }
}

// VEROUILLAGE DE CASE

function lock(id) {
  console.log("lock", mode);
  if (mode == "lock") {
    if (document.getElementById(id).classList.contains("locked")) {
      document.getElementById(id).classList.remove("locked");
      document.getElementById(id).classList.add("bingo_box");
    } else if (document.getElementById(id).classList.contains("bingo_box")) {
      document.getElementById(id).classList.remove("bingo_box");
      document.getElementById(id).classList.add("locked");
    }
  }
}

// SELECTION DE BUT

function goal(id) {
  if (mode == "goal") {
    if (document.getElementById(id).classList.contains("goal")) {
      document.getElementById(id).classList.remove("goal");
      document.getElementById(id).classList.add("bingo_box");
    } else if (document.getElementById(id).classList.contains("bingo_box")) {
      document.getElementById(id).classList.remove("bingo_box");
      document.getElementById(id).classList.add("goal");
    }
  }
}

// DESELECTION DE TOUT

function unselect() {
  for (let ligne = 1; ligne < 6; ligne++) {
    for (let colonne = 1; colonne < 6; colonne++) {
      let id = ligne.toString() + colonne.toString();
      if (document.getElementById(id).classList.contains("select")) {
        document.getElementById(id).classList.remove("select");
        document.getElementById(id).classList.add("bingo_box");
      }
      if (document.getElementById(id).classList.contains("goal")) {
        document.getElementById(id).classList.remove("goal");
        document.getElementById(id).classList.add("bingo_box");
      }
      if (document.getElementById(id).classList.contains("locked")) {
        document.getElementById(id).classList.remove("locked");
        document.getElementById(id).classList.add("bingo_box");
      }
      if (document.getElementById(id).classList.contains("win")) {
        document.getElementById(id).classList.remove("win");
        document.getElementById(id).classList.add("neutral");
      }
    }
  }
  grid_matrix = [
    [0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0],
  ];
}

let mode = "select";

function set_mode(str) {
  mode = str;
  document.getElementById(str + "er").className = "select";
  if (str + "er" != "selecter") {
    document.getElementById("selecter").className = "neutral";
  }
  if (str + "er" != "locker") {
    document.getElementById("locker").className = "neutral";
  }
  if (str + "er" != "goaler") {
    document.getElementById("goaler").className = "neutral";
  }
}

function gcl(a, c, m) {
  X0 = Math.floor(Math.random() * 10000);
  console.log(X0);
  for (let i = 0; i < 25; i++) {
    X0 = (a * X0 + c) % m;
  }
}

// CREATION DU BINGO

entries = [];
let lg = "short";

function uplist(temps) {
  lg = temps;
  document.getElementById("lg").innerText = lg;
  switch (temps) {
    case "short":
      entries = entries_copy(short_entries);
      break;
    case "mid":
      entries = entries_copy(mid_entries);
      break;
    case "long":
      entries = entries_copy(long_entries);
      break;
    case "random":
      entries = entries_copy(rnd_entries);
      break;
    default:
      entries = entries_copy(mid_entries);
      break;
  }
  SEED = Math.floor(Math.random() * 10000);
  document.getElementById("seed").innerText = SEED;
  bingo(SEED, entries);
  unselect();
}

function upseed(SEED) {
  switch (lg) {
    case "short":
      entries = entries_copy(short_entries);
      break;
    case "mid":
      entries = entries_copy(mid_entries);
      break;
    case "long":
      entries = entries_copy(long_entries);
      break;
    case "random":
      entries = entries_copy(rnd_entries);
      break;
    default:
      entries = entries_copy(mid_entries);
      break;
  }
  SEED = parseInt(SEED, 10);
  document.getElementById("seed").innerText = SEED;
  bingo(SEED, entries);
  unselect();
}

let coef_a = 74;
let coef_c = 75;
let modulo = 2 ** 16 + 1;

function gcl_step(X) {
  return (coef_a * X + coef_c) % modulo;
}

function bingo(SEED, entries) {
  if (SEED == 69) {
    for (let ligne = 1; ligne < 6; ligne++) {
      for (let colonne = 1; colonne < 6; colonne++) {
        document.getElementById(10 * ligne + colonne).innerText = "NICE";
      }
    }
  } else {
    for (let ligne = 1; ligne < 6; ligne++) {
      for (let colonne = 1; colonne < 6; colonne++) {
        L = entries.length;
        SEED = gcl_step(SEED);
        n = SEED % L;
        let value = entries[n];
        entries.splice(n, 1);
        document.getElementById(10 * ligne + colonne).innerText = value;
      }
    }
  }
}

// ============ Changement de Thème ======================================

function setTheme(themeName) {
  localStorage.setItem("theme", themeName);
  document.documentElement.className = themeName;
}

function toggleTheme() {
  if (localStorage.getItem("theme") === "theme-dark") {
    setTheme("theme-light");
  } else {
    setTheme("theme-dark");
  }
}

(function () {
  setTheme("theme-dark");
})();

// ======= Fonctions de TRI =======

var diff_coefs = [];
var compared_list = []; // Liste d'origine décrémentée
var diff_list = []; // Liste ordonée par difficultés
var new_el;
var dicho_bas = 0;
var dicho_hte = 1;

function indexify(list) {
  for (let i = 0; i < list.length; i++) {
    list[i] = [list[i], i];
  }
}

function sort_start(list) {
  compared_list = [...list];
  document.getElementById("chall_coef").innerText = diff_coefs.toString();
  if (diff_list.length == 0) {
    diff_list.push(compared_list.pop());
  }
  document.getElementById("comp_chall").innerText =
    diff_list[Math.floor(diff_list.length / 2)];
  new_el = compared_list.pop();
  document.getElementById("new_chall").innerText = new_el;
  console.log(diff_list, new_el);
}

function diff_add() {
  console.log(dicho_bas, dicho_hte);
  if (diff_list.length == 1) {
    diff_list.push(new_el); //ici diff_list.length = 2
    new_el = compared_list.pop();
    document.getElementById("new_chall").innerText = new_el;
  } else {
    dicho_bas = Math.ceil((dicho_bas + dicho_hte) / 2);
    if (dicho_bas == dicho_hte) {
      diff_list.splice(dicho_bas, 0, new_el);
      new_el = compared_list.pop();
      document.getElementById("new_chall").innerText = new_el;
      dicho_bas = 0;
      dicho_hte = diff_list.length;
      document.getElementById("comp_chall").innerText =
        diff_list[Math.floor((dicho_bas + dicho_hte) / 2)];
      console.log("Changement de défi");
    } else {
      document.getElementById("comp_chall").innerText =
        diff_list[Math.floor((dicho_bas + dicho_hte) / 2)];
      console.log("Changement de comparateur");
    }
  }
  console.log(diff_list, new_el);
  sort_end();
}

function diff_sub() {
  console.log(dicho_bas, dicho_hte);
  if (diff_list.length == 1) {
    diff_list.push(new_el); //ici diff_list.length = 2
    new_el = compared_list.pop();
    document.getElementById("new_chall").innerText = new_el;
  } else {
    dicho_hte = Math.floor((dicho_bas + dicho_hte) / 2);
    if (dicho_bas == dicho_hte) {
      diff_list.splice(dicho_bas, 0, new_el);
      new_el = compared_list.pop();
      document.getElementById("new_chall").innerText = new_el;
      dicho_bas = 0;
      dicho_hte = diff_list.length;
      document.getElementById("comp_chall").innerText =
        diff_list[Math.floor((dicho_bas + dicho_hte) / 2)];
      console.log("Changement de défi");
    } else {
      document.getElementById("comp_chall").innerText =
        diff_list[Math.floor((dicho_bas + dicho_hte) / 2)];
      console.log("Changement de comparateur");
    }
  }
  console.log(diff_list, new_el);
  sort_end();
}

function sort_end() {
  if (compared_list.length == 0) {
    document.getElementById("comp_chall").innerText = "Fin du TRI";
    document.getElementById("new_chall").innerText = "Fin du TRI";
    const c = Math.floor(100 / diff_list.length);
    for (let i = 0; i < diff_list.length; i++) {
      diff_coefs.push(i * c);
      console.log(diff_list[i], " ", i * c);
    }
  }
}
